---
import Layout from '../layouts/Layout.astro';
import Navigation from '../components/Navigation.vue';
import HeroSection from '../components/HeroSection.vue';
import ResearchSection from '../components/ResearchSection.vue';
import TeamSection from '../components/TeamSection.vue';
import PublicationsSection from '../components/PublicationsSection.vue';
import ProjectsSection from '../components/ProjectsSection.vue';
import ContactSection from '../components/ContactSection.vue';
import Footer from '../components/Footer.vue';

// Get content from MD files
const publicationFiles = import.meta.glob('../pages/publications/*.md', { eager: true });
const featuredPublications = Object.values(publicationFiles)
  .filter(file => file.frontmatter?.featured === true)
  .map(file => ({
    title: file.frontmatter.title,
    authors: file.frontmatter.authors,
    journal: file.frontmatter.journal,
    volume: file.frontmatter.volume,
    pages: file.frontmatter.pages,
    year: file.frontmatter.year,
    doi: file.frontmatter.doi,
    url: file.frontmatter.url,
    pdf: file.frontmatter.pdf,
    openAccess: file.frontmatter.openAccess,
    abstract: file.frontmatter.abstract,
    keywords: file.frontmatter.keywords,
    featured: file.frontmatter.featured
  }))
  .sort((a, b) => b.year - a.year);

// Get team members from MD files
const teamFiles = import.meta.glob('../pages/team/*.md', { eager: true });
const teamMembers = Object.entries(teamFiles).map(([filepath, file]) => ({
  ...file.frontmatter,
  url: filepath.replace('../pages', '').replace('.md', '')
}));

// Filter and categorize team members
const principals = teamMembers.filter(member => 
  member.role === 'principal-investigator' || 
  member.role === 'lab-manager'
).sort((a, b) => (a.order || 999) - (b.order || 999));

const phdStudents = teamMembers.filter(member => member.role === 'phd-student');
const mscStudents = teamMembers.filter(member => member.role === 'msc-student');

// Get hero content
const heroFile = await import('../content/hero.md');
const heroData = heroFile.frontmatter;

// Get contact content
const contactFile = await import('../content/contact.md');
const contactData = contactFile.frontmatter;
---

<Layout title="Marine Remote Sensing Lab">
  <Navigation client:load />
  <main>
    <HeroSection client:visible heroData={heroData} />
    <ResearchSection client:visible />
    <TeamSection client:visible teamData={{ principals, phdStudents, mscStudents }} />
    <PublicationsSection client:visible featuredPublications={featuredPublications} />
    <ContactSection client:visible contactData={contactData} />
  </main>
  <Footer />
</Layout>
